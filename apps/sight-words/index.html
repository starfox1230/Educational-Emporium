<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Vanta.js Capabilities Tester</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body, html { margin:0; padding:0; height:100%; overflow:hidden; font-family: sans-serif; }
    #vanta-canvas { width: 100%; height: 100%; }
    #controls {
      position: absolute; top: 1rem; left:1rem; z-index:100;
      background: rgba(255,255,255,0.85); border-radius:8px; padding:12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      max-height: calc(100vh - 4rem); /* Limit height to viewport minus margins */
      overflow-y: auto; /* Add scrollbar if needed */
    }
    #controls button {
      display: block; width: 200px; /* Wider for longer names */
      margin: 6px 0;
      padding: 8px 12px;
      font-size: 0.9rem; cursor: pointer;
      border: 1px solid #ccc; border-radius:4px; background: #e0e0e0; color:#333;
      text-align: left;
      transition: background-color 0.2s, color 0.2s;
    }
    #controls button:hover {
      background: #007bff; color:white; border-color: #007bff;
    }
    #controls button.active {
      background: #0056b3; color:white; border-color: #0056b3;
      font-weight: bold;
    }
    #current-effect-display {
      font-weight: bold;
      margin-bottom: 10px;
      padding: 6px 8px;
      background: rgba(0,0,0,0.05);
      border-radius: 4px;
      font-size: 0.95rem;
      border: 1px solid rgba(0,0,0,0.1);
      min-height: 1.2em; /* Prevent layout shift when text changes */
    }
  </style>
  <!-- THREE.js is a dependency for many Vanta effects -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  
  <!-- Vanta core -->
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.min.js"></script>
  
  <!-- Vanta effect modules (Order: Core, then specific effects) -->
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.fog.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.waves.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.birds.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.cells.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.clouds.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.dots.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.rings.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.halo.min.js"></script>
  <!-- Add other effects here if needed -->

</head>
<body>
  <div id="vanta-canvas"></div> <!-- Vanta will attach here -->

  <div id="controls">
    <div id="current-effect-display">Loading...</div>
    <!-- Buttons will be generated by JavaScript -->
  </div>

  <script>
    let vantaEffect = null;
    const vantaElement = document.getElementById('vanta-canvas');
    const controlsContainer = document.getElementById('controls'); // Parent of buttons
    const currentEffectDisplay = document.getElementById('current-effect-display');
    let currentActiveButton = null;

    const baseGlobalParams = {
      mouseControls: true,
      touchControls: true,
      gyroControls: false,
      minHeight: 200.00,
      minWidth: 200.00,
      scale: 1.00,
      scaleMobile: 1.00,
    };

    const effectConfigurations = {
      "FOG_Soft_Blue": { effect: "FOG", params: { highlightColor: 0x80deea, midtoneColor: 0x26c6da, lowlightColor: 0x00acc1, baseColor: 0xf4f6f8, blurFactor: 0.6, zoom: 1.2, speed: 1.0 }},
      "FOG_Mystic_Purple": { effect: "FOG", params: { highlightColor: 0xff00ff, midtoneColor: 0xaa00aa, lowlightColor: 0x550055, baseColor: 0x300030, blurFactor: 0.7, zoom: 1.0, speed: 0.8 }},
      "FOG_Sunrise": { effect: "FOG", params: { highlightColor: 0xffe082, midtoneColor: 0xffa726, lowlightColor: 0xfb8c00, baseColor: 0xffcc80, speed: 1.5, zoom: 0.8 }},
      "WAVES_Ocean": { effect: "WAVES", params: { color: 0x005577, shininess: 30, waveHeight: 15, waveSpeed: 0.8, zoom: 1.0 }},
      "WAVES_Lava": { effect: "WAVES", params: { color: 0xff3300, shininess: 10, waveHeight: 25, waveSpeed: 0.4, zoom: 0.75 }},
      "WAVES_Emerald": { effect: "WAVES", params: { color: 0x00897b, shininess: 50, waveHeight: 10, waveSpeed: 1.2, zoom: 0.9 }},
      "BIRDS_Day_Sky": { effect: "BIRDS", params: { backgroundColor: 0x87ceeb, color1: 0x444444, color2: 0x666666, birdSize: 1.0, wingSpan: 20.00, speedLimit: 3.00, separation: 20.00, alignment: 20.00, cohesion: 20.00, quantity: 4 }},
      "BIRDS_Sunset": { effect: "BIRDS", params: { backgroundColor: 0xffa07a, color1: 0x5d4037, color2: 0x000000, birdSize: 1.2, wingSpan: 25.00, quantity: 3, speedLimit: 2.00 }},
      "BIRDS_Monochrome": { effect: "BIRDS", params: { backgroundColor: 0xdcdcdc, color1: 0x000000, color2: 0x333333, birdSize: 0.8, wingSpan: 15.00, quantity: 5, separation: 30.00, alignment: 30.00, cohesion: 30.00 }},
      "NET_Cyber_Grid": { effect: "NET", params: { color: 0x00ffff, backgroundColor: 0x000022, points: 10.00, maxDistance: 20.00, spacing: 15.00, showDots: true }},
      "NET_Golden_Web": { effect: "NET", params: { color: 0xffd700, backgroundColor: 0x301934, points: 8.00, maxDistance: 25.00, spacing: 20.00, showDots: true }},
      "NET_Minimal_Lines": { effect: "NET", params: { color: 0xaaaaaa, backgroundColor: 0xffffff, points: 12.00, maxDistance: 18.00, spacing: 18.00, showDots: false }},
      "CELLS_Bio_Blue": { effect: "CELLS", params: { color1: 0x2196f3, color2: 0x90caf9, size: 3.0, speed: 1.0 }},
      "CELLS_Pulsing_Red": { effect: "CELLS", params: { color1: 0xf44336, color2: 0xffcdd2, size: 4.5, speed: 0.5 }},
      "CELLS_Amoeba_Green": { effect: "CELLS", params: { color1: 0x4CAF50, color2: 0x00796B, size: 2.0, speed: 2.0 }},
      "CLOUDS_Sunny_Day": { effect: "CLOUDS", params: { skyColor: 0x68b8d7, cloudColor: 0xadc1de, cloudShadowColor: 0x183550, sunColor: 0xff9919, sunGlareColor: 0xff6633, sunlightColor: 0xff9933, speed: 1.0 }},
      "CLOUDS_Evening_Sky": { effect: "CLOUDS", params: { skyColor: 0x334d5c, cloudColor: 0x8e8e8e, cloudShadowColor: 0x2e2e2e, sunColor: 0xf57c00, sunGlareColor: 0xffb74d, sunlightColor: 0xffa726, speed: 0.6 }},
      "CLOUDS_Pastel_Dream": { effect: "CLOUDS", params: { skyColor: 0xc9d6ff, cloudColor: 0xe2e2e2, cloudShadowColor: 0xb8b8b8, sunColor: 0xfbc2eb, sunGlareColor: 0xfa98cf, sunlightColor: 0xf7abc9, speed: 1.2 }},
      "DOTS_Starfield": { effect: "DOTS", params: { color: 0xffffff, color2: 0xdddddd, backgroundColor: 0x000011, size: 3.00, spacing: 30.00, showLines: false }},
      "DOTS_Colorful_Grid": { effect: "DOTS", params: { color: 0xff00ff, color2: 0x00ff00, backgroundColor: 0x222222, size: 5.00, spacing: 25.00, showLines: true }},
      "DOTS_Subtle_Connect": { effect: "DOTS", params: { color: 0x757575, color2: 0xBDBDBD, backgroundColor: 0xF5F5F5, size: 2.5, spacing: 40.00, showLines: true }},
      "RINGS_Golden_Aura": { effect: "RINGS", params: { backgroundColor: 0x110022, color: 0xffd700, strength: 2.00 }},
      "RINGS_Blue_Energy": { effect: "RINGS", params: { backgroundColor: 0x001020, color: 0x00aaff, strength: 3.50 }},
      "RINGS_Soft_White": { effect: "RINGS", params: { backgroundColor: 0xeeeeee, color: 0x888888, strength: 1.50 }},
      "HALO_Gentle_Sun": { effect: "HALO", params: { baseColor: 0xffe082, backgroundColor: 0xfff8e1, amplitudeFactor: 0.5, size: 1.0 }},
      "HALO_Deep_Space": { effect: "HALO", params: { baseColor: 0x7e57c2, backgroundColor: 0x1a001a, amplitudeFactor: 1.5, size: 1.2, xOffset: 0.2, yOffset: 0.1 }},
      "HALO_Green_Nebula": { effect: "HALO", params: { baseColor: 0x4db6ac, backgroundColor: 0x004d40, amplitudeFactor: 1.0, size: 0.8 }}
    };

    function applyEffect(configKey) {
      console.log(`[VANTA APPLY] Attempting to apply effect for key: ${configKey}`);

      if (vantaEffect) {
        console.log("[VANTA APPLY] Destroying previous effect instance:", vantaEffect);
        try {
          vantaEffect.destroy();
          console.log("[VANTA APPLY] Previous effect destroyed successfully.");
        } catch (e) {
          console.error("[VANTA APPLY] Error destroying previous effect:", e);
        }
        vantaEffect = null;
      } else {
        console.log("[VANTA APPLY] No previous effect instance to destroy.");
      }

      const config = effectConfigurations[configKey];
      if (!config) {
        console.error(`[VANTA APPLY] Configuration not found for key: ${configKey}`);
        currentEffectDisplay.textContent = `Error: Config ${configKey} not found`;
        return;
      }
      console.log(`[VANTA APPLY] Found configuration:`, config);

      if (typeof VANTA === 'undefined') {
        console.error("[VANTA APPLY] CRITICAL: Global VANTA object not found!");
        currentEffectDisplay.textContent = "Error: VANTA core not loaded.";
        return;
      }

      const VantaEffectConstructor = VANTA[config.effect];
      console.log(`[VANTA APPLY] Attempting to use Vanta constructor for '${config.effect}'. Found:`, VantaEffectConstructor);

      if (typeof VantaEffectConstructor !== 'function') {
        console.error(`[VANTA APPLY] Vanta effect constructor for '${config.effect}' is NOT a function or not found. Type: ${typeof VantaEffectConstructor}. Value:`, VantaEffectConstructor);
        currentEffectDisplay.textContent = `Error: Effect type '${config.effect}' is invalid or not loaded.`;
        console.log("[VANTA APPLY] Available properties on VANTA object:", Object.keys(VANTA));
        return;
      }

      const finalParams = {
        el: vantaElement,
        ...baseGlobalParams,
        ...config.params
      };
      console.log("[VANTA APPLY] Initializing Vanta effect with final params:", finalParams);
      
      try {
        vantaEffect = VantaEffectConstructor(finalParams);
        console.log("[VANTA APPLY] Vanta effect initialized successfully for '" + config.effect + "':", vantaEffect);
        if (!vantaEffect || typeof vantaEffect.destroy !== 'function') {
             console.warn("[VANTA APPLY] Initialized effect does not look like a valid Vanta instance (missing destroy method).");
        }
        currentEffectDisplay.textContent = `Current: ${configKey.replace(/_/g, ' ')}`;

        if (currentActiveButton) {
          currentActiveButton.classList.remove('active');
        }
        const newActiveButton = controlsContainer.querySelector(`button[data-config-key="${configKey}"]`);
        if (newActiveButton) {
          newActiveButton.classList.add('active');
          currentActiveButton = newActiveButton;
        } else {
          console.warn(`[VANTA APPLY] Could not find button element for configKey: ${configKey}`);
        }
      } catch (error) {
        console.error(`[VANTA APPLY] Error initializing Vanta effect '${config.effect}':`, error);
        currentEffectDisplay.textContent = `Error initializing ${config.effect}`;
        vantaEffect = null; 
      }
    }

    function populateControls() {
      const buttonFragment = document.createDocumentFragment();
      Object.keys(effectConfigurations).forEach((key, index) => {
        const button = document.createElement('button');
        button.textContent = `${index + 1}. ${key.replace(/_/g, ' ')}`;
        button.setAttribute('data-config-key', key);
        button.addEventListener('click', () => {
          // 'key' is correctly scoped here due to forEach's behavior with closures
          applyEffect(key); 
        });
        buttonFragment.appendChild(button);
      });
      // Append after currentEffectDisplay to keep it at the top
      controlsContainer.appendChild(buttonFragment);
    }

    document.addEventListener('DOMContentLoaded', () => {
      console.log("[VANTA INIT] DOMContentLoaded fired.");
      
      if (typeof THREE === 'undefined') {
          console.error("[VANTA INIT] THREE object is not defined. Check three.min.js loading and script order.");
          currentEffectDisplay.textContent = "Error: THREE.js failed to load!";
          return; // Stop if THREE is missing
      } else {
          console.log("[VANTA INIT] THREE object is defined.", THREE.REVISION);
      }

      if (typeof VANTA === 'undefined') {
          console.error("[VANTA INIT] VANTA object is not defined. Check vanta.min.js loading and script order.");
          currentEffectDisplay.textContent = "Error: VANTA core failed to load!";
          return; // Stop if VANTA is missing
      } else {
          console.log("[VANTA INIT] VANTA object is defined.");
          console.log("[VANTA INIT] Available VANTA effects/properties:", Object.keys(VANTA));
      }

      populateControls();
      const firstConfigKey = Object.keys(effectConfigurations)[0];
      if (firstConfigKey) {
        console.log(`[VANTA INIT] Applying initial effect: ${firstConfigKey}`);
        applyEffect(firstConfigKey);
      } else {
        console.warn("[VANTA INIT] No effects configured.");
        currentEffectDisplay.textContent = "No effects configured.";
      }
    });
  </script>
</body>
</html>